From b0fb9f38d9fabd3a087a12794464382994d885c6 Mon Sep 17 00:00:00 2001
From: Allan Sandfeld Jensen <allan.jensen@qt.io>
Date: Thu, 5 Sep 2019 11:12:38 +0200
Subject: [PATCH] [Backport] Fix security issue 957160
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Unregister offscreen canvas placeholder on destructor

Bug: 957160
Change-Id: Iac728dea4a9d1d8c841cb186526718d4c8c53cde
Reviewed-by: Fernando Serboncini <fserb@chromium.org>
Commit-Queue: Aaron Krajeski <aaronhk@chromium.org>
Cr-Commit-Position: refs/heads/master@{#657857}
Reviewed-by: Michael Br√ºning <michael.bruning@qt.io>
---
 .../blink/renderer/core/html/canvas/html_canvas_element.cc    | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/src/3rdparty/chromium/third_party/blink/renderer/core/html/canvas/html_canvas_element.cc b/src/3rdparty/chromium/third_party/blink/renderer/core/html/canvas/html_canvas_element.cc
index b3af4af7dd0..66fdad90e34 100644
--- a/src/3rdparty/chromium/third_party/blink/renderer/core/html/canvas/html_canvas_element.cc
+++ b/src/3rdparty/chromium/third_party/blink/renderer/core/html/canvas/html_canvas_element.cc
@@ -152,8 +152,10 @@ HTMLCanvasElement::~HTMLCanvasElement() {
 }
 
 void HTMLCanvasElement::Dispose() {
-  if (PlaceholderFrame())
+  if (PlaceholderFrame()) {
     ReleasePlaceholderFrame();
+    UnregisterPlaceholder();
+  }
 
   // We need to drop frame dispatcher, to prevent mojo calls from completing.
   frame_dispatcher_ = nullptr;
-- 
2.23.0

